<!DOCTYPE html>
<html lang="en" class="h-full">
    <head>
        <meta charset="UTF-8" />
        <title>
            {% block title %}
                PlexAniBridge
            {% endblock title %}
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description"
              content="PlexAniBridge: The smart way to keep your AniList profile perfectly synchronized with your Plex library." />
        <meta name="keywords"
              content="PlexAniBridge, Plex, AniList, anime, dashboard, mappings, logs, integration" />
        <meta name="color-scheme" content="dark" />
        <link rel="icon"
              type="image/x-icon"
              href="{{ url_for('static', path='favicon.ico') }}" />
        <link rel="stylesheet"
              href="{{ url_for('static', path='css/globals.css') }}" />
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4" crossorigin></script>
        <script src="https://cdn.jsdelivr.net/npm/iconify-icon@3/dist/iconify-icon.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/htmx.org@2/dist/htmx.min.js"></script>
        <script src="{{ url_for('static', path='js/anilist.js') }}"></script>
        <script src="{{ url_for('static', path='js/ws.js') }}"></script>
        {% block head_extra %}
        {% endblock head_extra %}
    </head>
    <body x-data="{ sidebarOpen: false }"
          class="min-h-dvh bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-950 via-slate-950 to-slate-900 text-slate-100 selection:bg-blue-600/40 selection:text-white antialiased">
        <a href="#main"
           class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:rounded-md bg-blue-600 px-3 py-2 text-sm font-medium text-white shadow-lg">Skip to content</a>
        <!-- Mobile overlay -->
        <div x-cloak
             x-show="sidebarOpen"
             x-transition.opacity
             class="fixed inset-0 z-30 bg-slate-900/70 backdrop-blur-sm lg:hidden"
             @click="sidebarOpen=false"></div>
        <!-- Sidebar -->
        <aside class="fixed inset-y-0 left-0 z-40 w-64 -translate-x-full border-r border-slate-800 bg-slate-950/95 px-3 pb-6 pt-4 shadow-xl shadow-slate-950/50 backdrop-blur transition-transform duration-300 ease-out lg:translate-x-0 flex flex-col"
               :class="{'translate-x-0': sidebarOpen}">
            <div class="mb-4 flex items-center gap-3 px-2">
                <img src="{{ url_for('static', path='img/logo.png') }}"
                     onerror="this.remove()"
                     class="h-8 w-8"
                     alt="Logo"
                     width="32"
                     height="32" />
                <div>
                    <h1 class="text-base font-semibold tracking-tight text-white">PlexAniBridge</h1>
                    <p class="text-[11px] uppercase tracking-wide text-slate-500">Sync Dashboard</p>
                </div>
            </div>
            <nav class="flex flex-col gap-1 font-medium text-sm" hx-boost="true">
                {% set path = request.path if request is defined else '' %}
                <a href="{{ url_for('dashboard') }}"
                   class="nav-link {{ 'nav-link-active' if path.startswith("/dashboard") else '' }}">
                    <iconify-icon icon="lucide:layout-dashboard" class="h-4 w-4"></iconify-icon>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('mappings') }}"
                   class="nav-link {{ 'nav-link-active' if path.startswith("/mappings") else '' }}">
                    <iconify-icon icon="lucide:list" class="h-4 w-4"></iconify-icon>
                    <span>Mappings</span>
                </a>
                <a href="{{ url_for('logs') }}"
                   class="nav-link {{ 'nav-link-active' if path.startswith("/logs") else '' }}">
                    <iconify-icon icon="lucide:terminal" class="h-4 w-4"></iconify-icon>
                    <span>Logs</span>
                </a>
                <div class="mt-4 text-[10px] font-semibold uppercase tracking-wider text-slate-500 px-3">System</div>
                <a href="{{ url_for('settings') }}"
                   class="nav-link {{ 'nav-link-active' if path.startswith("/settings") else '' }}">
                    <iconify-icon icon="lucide:settings" class="h-4 w-4"></iconify-icon>
                    <span>Settings</span>
                </a>
                <a href="{{ url_for('about') }}"
                   class="nav-link {{ 'nav-link-active' if path.startswith("/about") else '' }}">
                    <iconify-icon icon="lucide:activity" class="h-4 w-4"></iconify-icon>
                    <span>About</span>
                </a>
                <div class="mt-auto pt-4 border-t border-slate-800/60">
                    <p class="px-3 text-[11px] text-slate-500">Â© {{ now.year }} PlexAniBridge</p>
                </div>
            </nav>
        </aside>
        <!-- Main content wrapper -->
        <div class="flex min-h-dvh w-full flex-col lg:pl-64">
            <!-- Top bar -->
            <header class="sticky top-0 z-20 flex h-14 w-full items-center gap-3 border-b border-slate-800/80 bg-slate-950/80 px-4 backdrop-blur supports-[backdrop-filter]:bg-slate-950/65">
                <button type="button"
                        class="lg:hidden inline-flex h-9 w-9 items-center justify-center rounded-md border border-slate-700/70 bg-slate-800/70 text-slate-300 hover:text-white hover:bg-slate-700/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
                        @click="sidebarOpen = !sidebarOpen"
                        aria-label="Toggle navigation">
                    <iconify-icon :icon="sidebarOpen ? 'lucide:x' : 'lucide:menu'" class="h-5 w-5"></iconify-icon>
                </button>
                <div class="flex flex-1 items-center gap-3">
                    <div id="realtime-status"
                         class="hidden sm:flex items-center gap-2 rounded-md border border-slate-700/60 bg-slate-900/60 px-3 py-1.5 text-xs text-slate-400">
                        <span class="relative flex h-2 w-2">
                            <span class="absolute inline-flex h-full w-full animate-ping rounded-md bg-blue-500/60"></span>
                            <span class="relative inline-flex h-2 w-2 rounded-md bg-blue-500"></span>
                        </span>
                        <span class="font-medium">Live</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button type="button"
                            class="btn-base border border-slate-700/70 bg-slate-800/70 text-slate-300 hover:text-white hover:bg-slate-700/70 focus-visible:ring-blue-500"
                            @click="window.location.reload()">
                        <iconify-icon icon="lucide:rotate-cw" class="h-4 w-4"></iconify-icon>
                        <span class="hidden sm:inline">Refresh</span>
                    </button>
                </div>
            </header>
            <!-- Page content area -->
            <main id="main" hx-boost="true" class="flex-1 p-4 sm:p-6">
                <!-- Flash / alerts placeholder -->
                {% if get_flashed_messages is defined %}
                    {% with msgs = get_flashed_messages(with_categories=true) %}
                        {% if msgs %}
                            <div class="mb-4 space-y-2">
                                {% for category, message in msgs %}
                                    {% set color = "blue" %}
                                    {% if category in ['error','danger'] %}
                                        {% set color = "red" %}
                                    {% elif category in ['warning'] %}
                                        {% set color = "amber" %}
                                    {% elif category in ['success'] %}
                                        {% set color = "green" %}
                                    {% endif %}
                                    <div class="surface border-l-4 p-3 pr-4 {{ 'border-l-red-500' if color=='red' else '' }} {{ 'border-l-amber-500' if color=='amber' else '' }} {{ 'border-l-green-500' if color=='green' else '' }} {{ 'border-l-blue-500' if color=='blue' else '' }}">
                                        <div class="flex items-start gap-3">
                                            <iconify-icon icon="lucide:info" class="h-5 w-5 text-{{ color }}-400"></iconify-icon>
                                            <p class="text-sm text-slate-200">{{ message|safe }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}
                {% endif %}
                <div class="fade-in space-y-8">
                    {% block pre_content %}
                    {% endblock pre_content %}
                    {% block content %}
                    {% endblock content %}
                    {% block post_content %}
                    {% endblock post_content %}
                </div>
            </main>
            <!-- Footer -->
            <footer class="mt-auto border-t border-slate-800/80 bg-slate-950/70 px-4 py-4 text-xs text-slate-500 backdrop-blur">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 justify-between">
                    <div class="flex flex-row flex-wrap items-center gap-1">
                        <span>Made by</span>
                        <a href="https://github.com/eliasbenb"
                           target="_blank"
                           class="text-blue-400 underline underline-offset-2">@eliasbenb</a>
                    </div>
                    <div class="flex flex-row flex-wrap items-center gap-3">
                        <span>Version: <code class="text-slate-400">{{ version }}</code></span>
                        <a href="https://github.com/eliasbenb/PlexAniBridge"
                           target="_blank"
                           class="text-slate-400 hover:text-blue-400 inline-flex items-center gap-1">
                            <iconify-icon icon="lucide:github" class="h-4 w-4"></iconify-icon>
                            <span class="md:inline">GitHub</span>
                        </a>
                    </div>
                </div>
            </footer>
        </div>
        {% block body_end %}
        {% endblock body_end %}
    </body>
</html>
